# 自動酒精噴霧瓶

use LogicGreen LGT8F328P Microcontroller (AVR Mega328 compatible)


## 前言

辦公室的茶水區放了一個普通的 75% 酒精噴霧。疫情的關係，前陣子很多高手紛紛製作了不同樣式的自動噴霧。

我找了一些影片和資料，最後找了一個我比較喜歡的版本。說明網頁在這：

* [[小熊的開發日誌] 噴頭01 紅外線自動酒精噴霧器](https://blog.xuite.net/m0923678421/development/589011382)

我比較喜歡這個版本是因為它使用的是市面上的噴頭，沒有另外設計不同的容器或是噴灑方式，這對於製作的人來說很方便，我可以去 10 元店單獨買噴頭，然後把他設計的機構裝上去，最後換掉原來的舊噴頭就好。萬一之後不想用了，換回原本的噴頭就好。

另外，作者也很有心，他調查了市面上常見的幾款噴頭，總共製作出三種機構，分別適用於三種常見的噴頭。而且機構採模組化設計，換噴頭只有少數幾個元件需要重新列印。

* 作者的 Youtube 頻道 -- [熊的開發DVPBear](https://www.youtube.com/channel/UCx74OaAnnBDV6ml8Mc01qKQ)

## 完成品

![](images/sprayer-03.jpg)

Micro USB 供電。

![](images/sprayer-02.jpg)

之後還是有可能會把它拆掉（如果都沒有什麼人使用的話 XD），所以主板上盡可能共用焊點。Servo 的線我也沒有剪斷焊接 XD

![](images/sprayer-04.jpg)


## 製作方法

大致上你要做的事情有：

1. 選定噴頭。先去看作者的網誌或是 Youtube 頻道，記下三種不同的噴頭樣式，然後看看你可以買到哪一種。
2. 取得 3D 列印元件和螺絲組。
3. 根據影片說明組裝噴頭機構
4. 燒錄程式。程式我自己改寫了，後面說明。
5. 測試 & 修改程式


## 準備材料

### 3D 列印檔

你可以在他的網誌中找到他公開的 3D 列印的檔案自己列印，買齊說明中所提到的螺絲，然後看他 Youtube 裡面的教學一步步製作。三種噴頭都有對應的製作影片，蠻詳細的。

* [[抗疫] 噴頭01 紅外線自動酒精噴霧器 Arduino 酒精 異丙醇](https://www.youtube.com/watch?v=PxWWpVySzto)

我自己使用的是作者命名為 "噴頭01" 的檔案。

### 螺絲組

* M3 帶墊圓頭自攻尖嘴螺絲
	* 10mm x4 Servo
* M3 圓頭自攻平嘴螺絲
  * 4mm  x3 usb 電源板 + 連桿相連
  * 5mm  x1 開發板座
  * 6mm  x3 板機連桿 + 底座
  * 8mm  x1 02頭
  * 10mm x1 紅外測距 (01頭 +1)
* M2 皿頭自攻尖嘴螺絲
  * 6mm x2 servo 連桿

ps: 作者有公開 .stl 檔案，組裝說明也有提到需要怎樣規格的螺絲。你可以自己印然後自己去買齊螺絲，或是作者在露天也有提供材料包。


## 微處理器

原始的設計使用的是 Arduino Mini。機構上也有設計一個零件用來卡住 Arduino Mini。但我在左岸看到一個很便宜的 Arduino 相容板，好奇買來試試看。所以硬體機構的部分，我是直接使用原作者設計的。只有改換開發板和重寫程式而已（就是這個 repo 主要放的東西）。

![](images/LGT8F328P-SSOP20_MiniEVB1.jpg)

![](images/LGT8F328P-SSOP20_MiniEVB2.jpg)

Larduino_HSP_v3.6c/ 內的是原廠提供的 libraries 和 Arduino hardware 支援設定檔。根據 MiniEVB 的說明文件設定好 IDE 開發板的支援，即可在 Arduino IDE 環境下開發 MiniEVB

![](images/boards.png)


## 程式碼

sketchbook/ 資料夾內的是程式碼。`Auto_Sprayer_v2` 最終的運作版本。其餘的都是為了測試寫的。

Auto_Sprayer_v2.ino 的程式中，有一些行為處理：

* 如果手一直停在感測器前，還是只會噴酒精一次。必須離開遠一點再次靠近才會噴第二次。
* 為了避免人只是經過，被偵測到就噴酒精，所以判斷至少需要偵測一段時間才判定噴灑。程式碼中的決定變數是 keep_detecting_ms，目前設定 800ms。
* 將噴灑的行為包裝成函式 pulling_trigger() 傳入兩個參數，分別是 Servo 角度以及按下後停留多久復位。


## 小心得

### 使用金屬齒輪版本的 Servo

其實一開始做的時候我就買錯東西。我買了 MG996R 的 Servo，號稱有 13KG 的扭力（但其實還是推得很吃力）。但一開始裝好、程式燒錄好、執行幾下後發現 Servo 突然沒力了。打開看發現我買的 Servo 裡面是塑膠齒輪的，跑幾次後就滑牙了。後來在左岸看到有人單獨賣金屬齒輪，就買來替換。所以拖了一陣子才把它完成。

但我發現既使換了金屬齒輪，Servo 的下壓力量還是沒辦法像手壓一樣有較大的角度。有想過下圖 Servo 帶動的那個垂直連桿，如果再長一點點，會不會力矩效應會更好一些。也曾嘗試想把按壓的彈簧取出，想把它弄鬆，但不是很容易。而且可能造成按壓後把手無法復位。


### 調整噴口鬆緊

![](images/sprayer-01.jpg)

後來我才發現，噴頭的噴口是可以決定水噴出來的樣子，是霧狀還是水柱狀。當噴出來的液體越接近霧狀的時候，就需要更大的力量按壓，否則會比較像是滴水的樣子。所以其實我能做的最簡易調整方式，就是調整到一個中間值，讓液體噴出一些霧狀，同時 Servo 也有足夠的推力。

![](images/sprayer-06.jpg)


### 傾斜角度

我把自動噴頭機構旋上瓶身後，發現如果酒精的量不足的話，頭會太重往前傾倒 XD

另外，原始的噴瓶瓶放在桌面時，噴口方向是微微朝上的。但如果是要感應手靠近，然後自動噴灑的話，噴口其實微微朝下比較好。在公司廢料區找到一個設備的夾具，它有機構可以讓瓶子微微前傾，但又一定的重量可以讓瓶子不傾倒，在還沒有設計新的機構時，先拿來用吧。

![](images/sprayer-05.jpg)


~ END ~